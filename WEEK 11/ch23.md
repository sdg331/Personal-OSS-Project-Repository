# 23. [실습] 다양한 브랜치 병합 (Git Merge Practice)

## 1. 실습 개요 (Overview)
* **목표**:
    1. Git의 다양한 병합 방식(Fast-forward, 3-way, Squash)을 직접 실습한다.
    2. 상황에 따라 적절한 병합 옵션(`--no-ff`, `--squash`, `--ff-only`)을 사용한다.
    3. 병합 후의 커밋 히스토리(Graph) 변화를 확인하고 이해한다.

---

## 2. Fast-forward 병합 실습
### 2.1 실습 환경 준비 (일렬 상태 만들기)
* **상황**: `main` 브랜치에서 분기된 `topic` 브랜치만 커밋이 진행되고, `main`에는 추가 커밋이 없는 상태.
```bash
# 1. 저장소 생성 및 초기화
$ git init gline
$ cd gline

# 2. main 브랜치 커밋 (Base)
$echo 111 > f$ git add f
$ git commit -m "1"

# 3. topic 브랜치 생성 및 전환
$ git switch -c topic

# 4. topic 브랜치 추가 커밋 (A, B)
$ echo aaa > g
$ git add g
$ git commit -m "A"

$ echo bbb >> g
$ git commit -am "B"

2.2 병합 수행 (Fast-forward)

명령어:

Bash
$ git switch main       # main 브랜치로 이동
$ git merge topic       # 병합 수행
결과:

Fast-forward 메시지 출력.

별도의 병합 커밋(Merge Commit) 없이 main의 포인터가 topic 위치로 이동.

2.3 옵션: --ff-only

설명: Fast-forward가 가능한 경우(일렬 상태)에만 병합을 허용하는 안전장치.

Bash
$ git merge topic --ff-only
2.4 실습 복구 (Reset)

병합 이전 상태로 되돌리기 (실습 반복을 위해 사용)

Bash
$ git reset --hard [커밋해시]
# 또는
$ git reset --hard HEAD~~  # 2단계 전으로 이동
3. 3-way 병합 실습 (Merge Commit 생성)
3.1 강제 3-way 병합 (--no-ff)

상황: Fast-forward가 가능한 상태지만, 병합 이력을 남기기 위해 강제로 커밋을 생성함.

명령어:

Bash
$ git merge --no-ff topic
결과:

텍스트 에디터가 열리며 커밋 메시지 입력 창이 뜸.

기본 메시지: Merge branch 'topic' to 'main'

저장 후 종료하면 새로운 커밋이 생성되며 병합 완료.

3.2 메시지 옵션 사용 (-m)

에디터를 열지 않고 명령어 라인에서 바로 메시지 작성.

Bash
$ git merge --no-ff topic -m "merge --no-ff 옵션 사용 예제"
3.3 실제 3-way 상황 만들기

상황: main과 topic 브랜치 모두에 각각 새로운 커밋이 있어 갈라진 상태.

Bash
# main 브랜치에 추가 커밋
$ echo 222 >> f
$ git commit -am "2"

# 이 상태에서 병합 시도 (자동으로 3-way Merge 수행)
$ git merge topic -m "3-way merge 수행"
4. Squash 병합 실습 (--squash)
4.1 개념 및 명령어

개념: topic 브랜치의 모든 커밋(A, B 등)을 하나로 압축하여 main 브랜치의 스테이징 영역(Staged)에 가져옴.

명령어:

Bash
$ git merge --squash topic
결과 메시지:

Automatic merge went well; stopped before committing as requested

Squash commit -- not updating HEAD

(자동으로 커밋되지 않고, 변경 사항이 스테이징된 상태로 멈춤)

4.2 커밋 수행 (필수)

Squash 병합은 자동 커밋되지 않으므로 사용자가 직접 커밋해야 함.

Bash
$ git commit -m "Squash merge 3AB"
특징: 그래프상에서 두 브랜치가 선으로 연결되지 않고, 내용만 합쳐진 단독 커밋으로 남음.

5. 심화: 파일 수정 중 병합 (Dirty Working Directory)
상황: 작업 디렉토리의 파일(f)을 수정하고 커밋하지 않은 상태에서 병합을 시도.

Bash
$ echo 333 >> f    # 파일 수정 (Uncommitted)
$ git status       # modified: f 상태 확인

$ git merge topic -m "3-way merge"
결과:

충돌(Conflict)이 나지 않는 파일이라면 병합이 정상적으로 수행됨.

수정 중이던 내용은 그대로 유지됨.

6. 핵심 요약 (Summary)
Fast-forward: $ git merge [브랜치]

일렬 상태일 때 포인터만 이동. 이력이 남지 않음.

3-way Merge (강제): $ git merge --no-ff [브랜치]

병합 커밋을 강제로 생성하여 "병합했다"는 기록을 남김.

Squash Merge: $ git merge --squash [브랜치]

지저분한 커밋 이력을 하나로 뭉쳐서 깔끔하게 병합.

주의: 명령어 실행 후 반드시 $ git commit을 별도로 해줘야 함.