# 24. 병합 충돌과 해결 (Merge Conflict)

## 1. 병합 충돌(Conflict) 개요
### 1.1 충돌이란?
* **정의**: 두 브랜치를 병합(Merge)하는 과정에서, Git이 자동으로 합칠 수 없는 상황.
* **발생 상황**:
    * **3-way Merge** 상황에서 발생 (Fast-forward 아님).
    * 두 브랜치에서 **'동일한 파일'의 '동일한 라인'**을 서로 다르게 수정했을 때 발생.
* **Git의 대응**:
    * 병합 과정을 **일시 중단**함.
    * 충돌이 난 파일에 **충돌 기호(Conflict Markers)**를 표시.
    * 사용자에게 수동으로 해결하고 커밋할 것을 요청.
    * 프롬프트 상태가 `(main)`에서 `(main | MERGING)`으로 변경됨.

---

## 2. [실습] 충돌 상황 만들기 (Conflict Scenario)
*충돌을 실습하기 위해 인위적으로 같은 파일의 같은 위치를 수정하는 과정입니다.*

### 2.1 저장소 초기화 및 베이스 커밋 (Base)
```bash
# 1. 디렉토리 생성 및 초기화
$ git init gconflict
$ cd gconflict

# 2. 베이스 파일 생성 (공통 조상)
$echo 111 > f$ git add f
$ git commit -m "1"
````

### 2.2 'topic' 브랜치에서 수정 (Incoming Change)

```bash
# 1. topic 브랜치 생성 및 전환
$ git switch -c topic

# 2. 파일 수정 (111 -> 111 aaa)
$ echo aaa >> f

# 3. 커밋 (A)
$ git commit -am "A"
```

### 2.3 'main' 브랜치에서 수정 (Current Change)

```bash
# 1. main 브랜치로 복귀
$ git switch main

# 2. 동일한 파일 수정 (111 -> 111 222)
# 주의: topic 브랜치와 같은 라인을 건드려야 충돌이 남!
$ echo 222 >> f

# 3. 커밋 (2)
$ git commit -am "2"
```

-----

## 3\. 병합 시도 및 충돌 확인

### 3.1 병합 명령어 실행

```bash
$ git merge topic
```

### 3.2 실행 결과 (터미널 출력)

```text
Auto-merging f
CONFLICT (content): Merge conflict in f
Automatic merge failed; fix conflicts and then commit the result.
```

> **해석**: `f` 파일 자동 병합 시도 -\> 실패(CONFLICT) -\> 사용자가 직접 수정(fix) 후 커밋해라.

-----

## 4\. 충돌 해결 과정 (Resolution Steps)

*충돌 해결은 **[파일 수정] -\> [add] -\> [commit]** 의 3단계로 이루어집니다.*

### 4.1 파일 내용 확인 (충돌 기호 분석)

  * 에디터(VS Code, Vim 등)로 충돌난 파일 `f`를 엽니다.
  * Git이 생성한 **충돌 마커**를 이해해야 합니다.


```text
111
<<<<<<< HEAD
222
=======
aaa
>>>>>>> topic
```

  * **`<<<<<<< HEAD`**: 현재 브랜치(`main`)의 수정 내용 시작.
  * **`222`**: 현재 브랜치에서 수정한 내용.
  * **`=======`**: 구분선 (위쪽이 현재 브랜치, 아래쪽이 들어오는 브랜치).
  * **`aaa`**: 병합하려는 브랜치(`topic`)에서 수정한 내용.
  * **`>>>>>>> topic`**: 들어오는 브랜치 내용 끝.

### 4.2 코드 수정 (Edit)

  * 마커(`<<<<`, `====`, `>>>>`)를 모두 지우고, 최종적으로 원하는 코드만 남깁니다.
  * **경우의 수**:
    1.  `main` 내용만 남긴다 (`222`).
    2.  `topic` 내용만 남긴다 (`aaa`).
    3.  둘 다 남긴다 (`222`, `aaa`). -\> **실습에서는 이 방식 선택**

**[수정 후 파일 상태]:**

```text
111
222
aaa
```

*(충돌 기호가 모두 제거되고 깔끔한 코드가 되어야 함)*

### 4.3 병합 완료 처리 (Commit)

  * 수정이 끝났으면 Git에게 "해결했다"고 알려주고 병합을 마무리합니다.


```bash
# 1. 스테이징 영역에 추가 (해결 완료 표시)
$ git add f

# 2. 상태 확인 (선택 사항)
$ git status
# 출력: All conflicts fixed but you are still merging.

# 3. 커밋 수행 (메시지는 자동 생성됨)
$ git commit
```

  * **참고**: `git commit`만 입력하면 기본 에디터가 뜨면서 `Merge branch 'topic'` 메시지가 자동 입력됩니다. 저장 후 닫으면 병합이 완료됩니다.

-----

## 5\. 병합 중단하기 (Abort)

  * 충돌 해결이 너무 어렵거나, 실수로 병합을 시도했을 때 **병합 시작 전 상태**로 되돌리는 방법입니다.


```bash
$ git merge --abort
```

  * **결과**: `(main | MERGING)` 상태가 해제되고, `git merge` 명령어를 입력하기 전의 깨끗한 상태로 돌아갑니다.

-----

## 6\. 핵심 요약 (Summary)

1.  **충돌 발생**: 3-way Merge 중 **같은 라인**을 서로 다르게 수정했을 때 발생.
2.  **Git의 행동**: 자동 병합을 멈추고 파일에 `<<<<<<<`, `=======`, `>>>>>>>` 마커를 남김.
3.  **해결 방법**:
    1.  파일을 열어 마커를 지우고 코드를 알맞게 수정한다.
    2.  `git add <파일>`로 해결됨을 알린다.
    3.  `git commit`으로 병합을 확정한다.
4.  **비상 탈출**: 해결이 힘들면 `$ git merge --abort`로 취소한다.