# 22. 다양한 브랜치 병합 (Git Merge Strategies)

## 1. 병합(Merge) 개요
### 1.1 병합의 정의
* **Merge**: 두 개의 갈라진 브랜치를 하나로 합치는 과정.
* **기본 원칙**: 현재 위치한 브랜치(HEAD)로 대상 브랜치의 변경 사항을 가져옴.

### 1.2 병합의 주요 방식
1.  **Fast-forward (빨리 감기)**: 단순히 포인터만 앞으로 이동.
2.  **3-way Merge**: 공통 조상을 기준으로 새로운 커밋을 생성하며 병합.

---

## 2. 병합 방식 상세 (Merge Types)

### 2.1 Fast-forward Merge (빨리 감기 병합)
* **상황**: 기준 브랜치(예: `main`)에서 분기된 이후, 기준 브랜치에 **추가적인 커밋이 없는 상태**에서 병합할 때.
* **동작 원리**:
    * 별도의 병합 커밋(Merge Commit)을 생성하지 않음.
    * 단순히 `main` 브랜치의 포인터(HEAD)를 대상 브랜치의 최신 커밋 위치로 이동시킴.
* **특징**: 히스토리가 한 줄로 깔끔하게 유지됨.

### 2.2 3-way Merge (3-way 병합)
* **상황**: 분기 이후, 두 브랜치 모두에 **각자 새로운 커밋이 발생하여 갈라진 상태**.
* **동작 원리**: 다음 3가지 커밋을 참고하여 병합을 수행함.
    1.  내 브랜치 (Mine / `HEAD`)
    2.  대상 브랜치 (Theirs / 병합 대상)
    3.  **공통 조상 (Base / Common Ancestor)**
* **결과**: 두 브랜치를 이어주는 **새로운 병합 커밋(Merge Commit)**이 생성됨.

---

## 3. 병합 옵션 및 고급 기능 (Advanced Options)

### 3.1 강제 병합 커밋 생성 (`--no-ff`)
* **명령어**: `$ git merge --no-ff [브랜치명]`
* **개념**: Fast-forward가 가능한 상황(일렬 상태)이라도, **강제로 3-way Merge처럼 병합 커밋을 남기는 방식**.
* **목적**:
    * 기능 구현이 완료되어 병합했다는 **이력(History)을 명확히 남기기 위함**.
    * 나중에 어떤 브랜치에서 작업했는지 확인하기 용이함.

### 3.2 스쿼시 병합 (`--squash`)
* **명령어**:
    ```bash
    $ git merge --squash [브랜치명]
    $ git commit -m "새로운 통합 메시지"
    ```
* **개념**: 대상 브랜치의 **모든 커밋 이력을 하나로 압축(Squash)**하여, 현재 브랜치의 스테이징 영역(Staged)에 가져옴.
* **특징**:
    * **자동 커밋되지 않음**: 병합 명령 후 사용자가 직접 `commit` 해야 함.
    * **히스토리 정리**: 작업 브랜치의 자잘한 커밋(오타 수정, WIP 등)을 메인 브랜치에 남기고 싶지 않을 때 유용.
    * 병합된 브랜치와 연결 고리(선)가 남지 않고, 내용만 하나로 합쳐져서 들어옴.

---

## 4. 실습 및 비교 요약 (Comparison)

| 구분 | Fast-forward | 3-way Merge | Squash Merge |
| :--- | :--- | :--- | :--- |
| **상황** | 기준 브랜치에 변화 없음 | 양쪽 다 변화 있음 | 깔끔한 이력 필요 시 |
| **커밋 생성** | 생성 안 함 (포인터 이동) | **자동 생성** (Merge Commit) | **생성 안 함** (Staged 상태로 둠) |
| **히스토리** | 일직선 유지 | 분기 후 다시 합류하는 모양 | 단일 커밋으로 통합됨 |
| **명령어** | `git merge [브랜치]` | `git merge [브랜치]` | `git merge --squash [브랜치]` |

---

## 5. 핵심 요약 (Key Takeaways)
* **일렬 상태**라면 Git은 기본적으로 **Fast-forward**를 수행한다.
* **갈라진 상태**라면 Git은 자동으로 **3-way Merge**를 수행하여 병합 커밋을 만든다.
* 이력을 남기고 싶다면 **`--no-ff`**, 이력을 하나로 퉁치고 싶다면 **`--squash`** 옵션을 사용한다.