# Git 브랜치 개요와 관리 정리

## 📚 학습 목표

1. **브랜치의 필요성**과 개념 이해
2. **브랜치 생성 및 이동** 방법 습득
3. **브랜치 목록 확인 및 삭제** 작업 수행
4. 독립적인 브랜치에서 **커밋 작업** 수행

---

## 1️⃣ 브랜치(Branch)란?

### 브랜치의 개념

#### 실생활 비유
- **Branch**: 나무의 가지, 지점
- 하나의 나무(프로젝트)에서 여러 가지(브랜치)가 뻗어나가는 형태

#### Git에서의 브랜치
- **정의**: 버전 관리를 수행하던 일련의 파일 집합을 통째로 복사해 독립적으로 다시 개발을 진행하는 개념
- **목적**: 여러 개발자가 타인을 신경 쓰지 않고 동시에 다양한 작업을 할 수 있게 만드는 기능
- **핵심**: 하나의 프로젝트를 여러 갈래로 나누어서 관리

### 브랜치의 필요성

#### 실무 시나리오
```
프로젝트 폴더를 통째로 복사하는 경우:
📁 project_v1
📁 project_v2_실험
📁 project_버그수정
📁 project_최종
```
→ Git 브랜치를 사용하면 **하나의 저장소 내에서 모두 관리 가능**

---

## 2️⃣ 브랜치 사용 장점

### 독립적인 작업 공간
- **저장소 내 다른 브랜치에 영향 없이** 새로운 기능 개발 가능
- **버그 수정** 작업을 별도로 진행 가능
- **새로운 아이디어를 안전하게 실험** 가능

### 브랜치 병합(Merge)
- 독립된 브랜치에서 마음대로 소스 코드를 변경하여 작업
- 작업 완료 후 원래 버전과 **병합(merge)** 수행
- 브랜치와 브랜치를 합치는 작업

### 시각적 이해
```
main ──────●──────●──────●──────●────── (메인 개발 라인)
             \            /
              \          /
topic          ●────●───          (새 기능 개발)
               
bugfix    ●────●                  (버그 수정)
           \    /
            ───                    (병합 후 main에 반영)
```

---

## 3️⃣ 기본 브랜치 (Default Branch)

### main 브랜치
- **저장소 생성 시** 처음 만들어지는 브랜치
- **과거**: `master`라는 이름 사용
- **현재**: `main`이 표준 (GitHub 등에서 권장)

### 기본 브랜치 설정

#### 전역 설정 (새로운 저장소에 적용)
```bash
git config --global init.defaultBranch main
```
- 앞으로 생성되는 모든 저장소의 기본 브랜치가 `main`으로 설정

#### 기존 저장소의 브랜치 이름 변경
```bash
git branch -M newBname
```
- `-M`: Move/Rename (강제 이름 변경)
- 현재 브랜치의 이름을 `newBname`으로 변경

#### 예시
```bash
# 작업 전
PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (main)
$ git branch -M master

# 작업 후
PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (master)
```

---

## 4️⃣ 브랜치와 HEAD의 관계

### 브랜치의 본질
- **포인터(Pointer)**: 커밋 사이를 가볍게 이동할 수 있는 포인터
- 특정 커밋을 가리키는 **참조(reference)**
- `checkout`, `switch` 명령으로 이동

### HEAD란?
- **정의**: 작업 중인 브랜치의 최신 커밋을 가리키는 포인터
- **역할**: "현재 어디서 작업하고 있는가"를 나타냄
- 필요에 따라 특정 커밋이나 브랜치를 가리키도록 이동 가능

### 시각적 이해

#### 첫 번째 커밋 후
```
README
  ↑
e2f09ef (커밋 A)
  ↑
main ──────┐
           ↑
         HEAD
```
- `main` 브랜치는 생성된 커밋 `e2f09ef`를 가리킴
- `HEAD`는 현재 작업 브랜치인 `main`을 가리킴
- 로그 표시: `(HEAD -> main)`

#### 두 번째 커밋 후
```
README      README
  ↑         hi.txt
e2f09ef  ←  5edf1de (커밋 B)
(커밋 A)      ↑
            main ──────┐
                       ↑
                     HEAD
```
- `main` 브랜치는 **자동으로 가장 마지막 커밋**을 가리킴
- 커밋 `5edf1de`는 부모 커밋 `e2f09ef`를 가리킴

### 커밋 구조
- **커밋 ID**: 16진수 40자리 해시값 (예: `5edf1de...`)
- **부모 커밋**: 이전 커밋을 참조
- **브랜치**: 최신 커밋을 가리킴

---

## 5️⃣ 브랜치 생성

### 브랜치 생성 명령어

#### 기본 생성 (HEAD 이동 없음)
```bash
git branch bname
```
- 새로운 브랜치 `bname` 생성
- **HEAD는 현재 위치에 그대로 유지**

#### 예시
```bash
PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (main)
$ git branch topic

PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (main)
$ git branch
* main      # *표시 = 현재 작업 중인 브랜치
  topic
```

### 시각화
```
README
hi.txt
  ↑
5edf1de (커밋 B)
  ↑      ↑
main   topic
  ↑
HEAD
```
- `main`과 `topic` 모두 같은 커밋 `5edf1de`를 가리킴
- `HEAD`는 여전히 `main`을 가리킴 (작업 브랜치는 `main`)

---

### 생성과 동시에 이동

#### switch 명령 사용 (최신 권장)
```bash
git switch -c bname
```
- `-c`: create (생성)
- 브랜치 생성 + HEAD 이동을 한 번에 수행

#### checkout 명령 사용 (구버전 방식)
```bash
git checkout -b bname
```
- `-b`: branch (브랜치 생성 + 이동)
- `switch` 명령이 도입되기 전 사용하던 방식

---

## 6️⃣ 브랜치 확인

### 브랜치 목록 조회

#### 기본 명령
```bash
git branch
```
- **커밋이 발생한 브랜치 목록** 표시
- `*` 표시: 현재 작업하고 있는 브랜치

#### 예시 출력
```bash
PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (main)
$ git branch
* main
  topic
```

#### 상세 정보 포함
```bash
git branch -v
```
- 브랜치마다 **마지막 커밋 ID**와 **커밋 메시지**도 함께 표시

#### 예시 출력
```bash
$ git branch -v
* main   5edf1de Add hi.txt
  topic  5edf1de Add hi.txt
```

---

## 7️⃣ 브랜치 이동 (전환)

### 브랜치 간 이동

#### switch 명령 (최신 권장)
```bash
git switch [bname]
```
- **HEAD를 지정한 브랜치로 이동**
- 작업 디렉토리의 파일들도 해당 브랜치 상태로 변경

#### checkout 명령 (구버전)
```bash
git checkout [bname]
```

#### 예시
```bash
PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (main)
$ git switch topic
Switched to branch 'topic'

PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (topic)
# 프롬프트의 브랜치 이름이 (topic)으로 변경됨
```

### 시각화
```
이동 전:
README
hi.txt
  ↑
5edf1de
  ↑      ↑
main   topic
  ↑
HEAD

이동 후:
README
hi.txt
  ↑
5edf1de
  ↑      ↑
main   topic
         ↑
       HEAD
```

### 이전 브랜치로 빠르게 이동

#### switch 명령
```bash
git switch -
```

#### checkout 명령
```bash
git checkout -
```
- `-`: 바로 직전에 작업하던 브랜치로 이동
- 빠른 브랜치 전환에 유용

---

## 8️⃣ 분리된(Detached) HEAD

### Detached HEAD란?
- **HEAD가 브랜치가 아닌 특정 커밋을 직접 가리키는 상태**
- 현재 브랜치의 마지막 커밋이 아닌, 이전 커밋으로 이동한 상태

### 발생 시나리오
```bash
git checkout HEAD~
```
- 현재 브랜치에서 **마지막 커밋 이전 커밋으로 이동**
- `~`: tilde(틸드) - 이전 커밋을 의미

### 상대 참조 방식

#### 틸드(~) 사용
```bash
HEAD~      # 1개 이전 커밋
HEAD~~     # 2개 이전 커밋
HEAD~3     # 3개 이전 커밋
```

#### 캐럿(^) 사용
```bash
HEAD^      # 1개 이전 커밋
HEAD^^     # 2개 이전 커밋
HEAD^^^    # 3개 이전 커밋
```

#### 커밋 ID 직접 사용
```bash
git checkout e2f09ef
```

### 시각화
```
일반 상태:
README      README
  ↑         hi.txt
e2f09ef  ←  5edf1de
            ↑      ↑
          main   topic
                   ↑
                 HEAD

Detached HEAD 상태:
README      README
  ↑         hi.txt
e2f09ef  ←  5edf1de
  ↑            ↑      ↑
HEAD         main   topic
(분리됨)
```

### 주의사항
- Detached HEAD 상태에서 커밋하면 **브랜치에 연결되지 않은 고아 커밋** 생성
- 다른 브랜치로 이동 시 고아 커밋은 나중에 삭제될 수 있음
- 작업을 저장하려면 새 브랜치 생성 필요

---

## 9️⃣ 브랜치에서 커밋 작업

### 시나리오: topic 브랜치에서 작업

#### 1단계: 브랜치 생성 및 이동
```bash
# main 브랜치에 있는 상태
git branch topic        # topic 브랜치 생성
git switch topic        # topic 브랜치로 이동
```

```
상태:
README
hi.txt
  ↑
5edf1de (커밋 B)
  ↑      ↑
main   topic
         ↑
       HEAD
```

#### 2단계: topic 브랜치에서 커밋
```bash
# 파일 작업
echo "topic content" > to.txt
git add to.txt
git commit -m "TOP1"
```

```
상태:
README      README       README
  ↑         hi.txt       hi.txt
e2f09ef  ←  5edf1de  ←   to.txt
(A)         (B)          46a0eb3 (TOP1)
            ↑            ↑
          main         topic
                         ↑
                       HEAD
```
- `topic` 브랜치만 새로운 커밋 `46a0eb3`를 가리킴
- `main` 브랜치는 여전히 `5edf1de`를 가리킴

---

### 시나리오: main 브랜치로 돌아가서 작업

#### 3단계: main 브랜치로 이동
```bash
git switch main
```

```
상태:
README      README       README
  ↑         hi.txt       hi.txt
e2f09ef  ←  5edf1de  ←   to.txt
(A)         (B)          46a0eb3 (TOP1)
            ↑            ↑
          main         topic
            ↑
          HEAD
```
- `HEAD`가 `main`으로 이동
- 작업 디렉토리에서 `to.txt` 파일이 사라짐 (main 브랜치에는 없으므로)

#### 4단계: main 브랜치에서 커밋
```bash
# 다른 파일 작업
echo "main content" > ma.txt
git add ma.txt
git commit -m "C"
```

```
최종 상태:
README      README       README
  ↑         hi.txt       hi.txt
e2f09ef  ←  5edf1de  ←   to.txt
(A)         (B)     ↑    46a0eb3 (TOP1)
                    |    ↑
                    └─   topic
                    README
                    hi.txt
                    ma.txt
                    136505f (C)
                    ↑
                  main
                    ↑
                  HEAD
```
- **브랜치가 분기됨**: `main`과 `topic`이 서로 다른 방향으로 발전
- 각 브랜치는 독립적인 커밋 히스토리를 가짐

---

## 🔟 이전 커밋에서 새 브랜치 생성

### 복잡한 브랜치 구조 만들기

#### 실습 시나리오
```bash
# main 브랜치로 이동
git switch main

# 한 단계 이전 커밋으로 이동 (Detached HEAD)
git checkout HEAD~

# 그 위치에서 hotfix 브랜치 생성 및 이동
git switch -c hotfix

# 다시 같은 위치에서 develop 브랜치 생성 및 이동
git checkout -b develop
```

#### 브랜치 목록 확인
```bash
PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (develop)
$ git branch
* develop
  hotfix
  main
  topic
```

### 시각화
```
README      README       README
  ↑         hi.txt       hi.txt
e2f09ef  ←  5edf1de  ←   to.txt
(A)         (B)     ↑    46a0eb3 (TOP1)
            ↑       |    ↑
         hotfix     └─   topic
         develop         
            ↑        README
          HEAD       hi.txt
                     ma.txt
                     136505f (C)
                     ↑
                   main
```
- `hotfix`와 `develop` 브랜치는 커밋 `5edf1de`에서 생성됨
- `main`과 `topic`은 각각 다른 커밋을 가리킴

---

## 1️⃣1️⃣ 브랜치 삭제

### 병합 상태 확인

#### 병합된 브랜치 목록
```bash
git branch --merged
```
- **현재 작업 브랜치를 기준으로** 병합된 브랜치 목록 표시
- 현재 작업 브랜치는 일반적으로 `--merged`에 포함됨

#### 병합되지 않은 브랜치 목록
```bash
git branch --no-merged
```
- 현재 작업 브랜치를 기준으로 **아직 병합되지 않은** 브랜치 목록 표시

#### 특정 브랜치 기준 확인
```bash
git branch --merged branchName      # branchName 기준 병합된 브랜치
git branch --no-merged branchName   # branchName 기준 병합 안 된 브랜치
```

---

### 브랜치 삭제 명령어

#### 일반 삭제 (병합된 브랜치만)
```bash
git branch -d [branchName]
git branch --delete [branchName]
```
- **이미 병합된 브랜치**만 삭제 가능
- 병합되지 않은 브랜치는 삭제 거부 (안전장치)

#### 강제 삭제 (병합 여부 무시)
```bash
git branch -D [branchName]
```
- 병합되지 않았더라도 **강제로 삭제**
- 작업 내용이 손실될 수 있으므로 주의!

---

### 브랜치 삭제 실습

#### 예시
```bash
PC@DESKTOP-482NOAB MINGW64 /c/[smart Git]/gbrch (develop)
$ git branch -d hotfix
Deleted branch hotfix (was 5edf1de).
```

#### 시각화
```
삭제 전:
README      README
  ↑         hi.txt
e2f09ef  ←  5edf1de
(A)         (B)
            ↑       ↑
         hotfix   develop
                    ↑
                  HEAD

삭제 후:
README      README
  ↑         hi.txt
e2f09ef  ←  5edf1de
(A)         (B)
            ↑
         develop
            ↑
          HEAD
```

#### ⚠️ 중요 규칙
- **현재 작업 중인 브랜치는 삭제 불가**
- 다른 브랜치로 이동한 후 삭제해야 함
- 예: `develop` 브랜치에 있어야 `hotfix` 브랜치 삭제 가능

---

## 1️⃣2️⃣ 브랜치 관련 명령어 완전 정리

### checkout vs switch 비교표

| 작업 내용 | git checkout | git switch (최신) |
|-----------|--------------|-------------------|
| **이전 커밋으로 이동** | `git checkout [이전커밋]` | `git switch -d [이전커밋]` |
| **다른 브랜치로 이동** | `git checkout [branch]` | `git switch [branch]` |
| **새 브랜치 생성 + 이동** | `git checkout -b [newBranch]` | `git switch -c [newBranch]` |
| **이전 브랜치로 이동** | `git checkout -` | `git switch -` |

### 왜 switch가 도입되었나?
- `checkout` 명령은 **너무 많은 기능**을 수행 (브랜치 전환, 파일 복원 등)
- `switch`는 **브랜치 전환에만 집중** → 더 명확하고 안전
- `restore`는 **파일 복원 전용** → 역할 분리

---

### 전체 명령어 요약

#### 브랜치 생성
```bash
git branch <new-branch>              # 생성만 (이동 안 함)
git checkout -b <new-branch>         # 생성 + 이동 (구버전)
git switch -c <new-branch>           # 생성 + 이동 (최신)
```

#### 브랜치 조회
```bash
git branch                           # 브랜치 목록
git branch -v                        # 마지막 커밋 정보 포함
git branch --merged                  # 병합된 브랜치
git branch --no-merged               # 병합 안 된 브랜치
```

#### 브랜치 이동
```bash
git checkout [branch]                # 브랜치 이동 (구버전)
git switch [branch]                  # 브랜치 이동 (최신)
git switch -                         # 이전 브랜치로
git checkout HEAD~                   # 이전 커밋으로 (Detached HEAD)
```

#### 브랜치 삭제
```bash
git branch -d branch-name            # 일반 삭제 (병합된 것만)
git branch --delete branch-name      # 일반 삭제 (풀네임)
git branch -D branch-name            # 강제 삭제 (병합 여부 무관)
```

#### 도움말
```bash
git branch -h                        # 간단한 도움말
git branch --help                    # 상세 매뉴얼
```

---

## 💡 실전 활용 팁

### 브랜치 네이밍 컨벤션
```bash
main              # 메인 개발 라인
develop           # 개발용 통합 브랜치
feature/login     # 새 기능 개발
feature/payment   # 새 기능 개발
bugfix/issue-123  # 버그 수정
hotfix/security   # 긴급 수정
release/v1.0.0    # 릴리스 준비
```

### 작업 흐름 예시
```bash
# 1. 새 기능 개발 시작
git switch -c feature/new-feature

# 2. 작업 및 커밋
git add .
git commit -m "Add new feature"

# 3. main으로 돌아가기
git switch main

# 4. 병합 (다음 장에서 학습)
git merge feature/new-feature

# 5. 기능 브랜치 삭제
git branch -d feature/new-feature
```

### 자주 하는 실수와 해결법

#### 실수 1: 브랜치를 만들지 않고 main에서 직접 작업
```bash
# ❌ 잘못된 방법
git switch main
# (main에서 직접 작업...)

# ✅ 올바른 방법
git switch main
git switch -c feature/my-work
# (새 브랜치에서 작업...)
```

#### 실수 2: 현재 브랜치 삭제 시도
```bash
# ❌ 에러 발생
git branch -d current-branch
# error: Cannot delete branch 'current-branch' checked out at '...'

# ✅ 올바른 방법
git switch main              # 다른 브랜치로 이동
git branch -d current-branch  # 이제 삭제 가능
```

#### 실수 3: 작업 중인 브랜치 전환
```bash
# 변경사항이 있는 상태에서 브랜치 전환 시도
git switch other-branch
# error: Your local changes would be overwritten

# 해결 방법 1: 커밋하기
git add .
git commit -m "Work in progress"

# 해결 방법 2: 임시 저장 (stash - 다음 장에서 학습)
git stash
git switch other-branch
```

---

## 📊 브랜치 실습 연습 문제

### 연습 1: 기본 브랜치 생성과 이동
```bash
# 저장소 생성
git init practice-branch
cd practice-branch

# 파일 생성 및 커밋
echo "Hello" > file.txt
git add file.txt
git commit -m "Initial commit"

# 브랜치 생성 및 확인
git branch feature
git branch
# * main
#   feature

# 브랜치 이동 및 확인
git switch feature
git branch
#   main
# * feature
```

### 연습 2: 여러 브랜치에서 독립적 작업
```bash
# feature 브랜치에서 작업
git switch feature
echo "Feature content" > feature.txt
git add feature.txt
git commit -m "Add feature"

# main 브랜치로 돌아가서 작업
git switch main
echo "Main content" > main.txt
git add main.txt
git commit -m "Add main content"

# 로그 확인
git log --oneline --graph --all
```